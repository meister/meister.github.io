name: Build Site

# Controls when the action will run.
on:
  workflow_dispatch:
    inputs:
      version:
        description: 'Version of the library'
        required: true

jobs:
  build_site:
    runs-on: ubuntu-latest
    steps:
    - run: env
    - run: ls -lR ${GITHUB_WORKSPACE}
    - run: ls -lR ${GITHUB_PATH}
    - run: |
        echo "Hello! Started build on version ${{ github.event.inputs.version }}!"
    - uses: actions/checkout@v2
    - uses: actions/setup-node@v2
      with:
        node-version: '14'
    # - run: ${GITHUB_WORKSPACE}/scripts/build.sh
    - name: Build Site index
      run: |
        npx meister |
          sed -E 's/\[39m/<\/span>/g' |
          sed -E 's/\[90m/<span class="color-90">/g' |
          sed -E 's/\[38\;5\;([0-9]+)m/<span class="color-\1">/g' > index.html
    - name: Commit & push updates to Github
      run: |
        git config user.name ${GITHUB_ACTOR}
        git config user.email gh-actions-${GITHUB_ACTOR}@github.com
        git add index.html
        git commit -m "Updated contents from ${{ github.event.inputs.version }}"
        git remote add gh-origin https://${GITHUB_ACTOR}:${{ secrets.GITHUB_TOKEN }}@github.com/${GITHUB_REPOSITORY}.git
        git push gh-origin HEAD:master
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
